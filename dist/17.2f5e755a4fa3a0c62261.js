(window.webpackJsonp=window.webpackJsonp||[]).push([[17,48,49],{"/Jkk":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return d});var l=i("Qb4n"),s=i("ysz4"),r=i("kZAv"),n=i("0Pcb"),o=i("JaKB"),h=i("lLY/");class d extends l.a{constructor(){super(),this.rects=[],this.circles=[],this.ctx=this.getContext("2d"),this.isCollide=!1,this.collideColor="rgba(244, 85, 65, 0.8)",this.collide=new h.default}createRect(){let{width:t,height:e,rects:i}=this,l=["rgba(66, 134, 244, 0.5)","rgba(65, 244, 223, 0.5)"],r=i=>{let r=Math.min(Math.min(t,e)/5,100);r+=r/4*i;let n=Math.floor(Object(s.d)(0,t)),h=Math.floor(Object(s.d)(0,e));return n+r>t&&(n-=r),h+r>e&&(h-=r),new o.RectSprite({name:`rect_${i}`,left:n,top:h,width:r,height:r,fillStyle:l[i%2],visible:!0})};for(let t=0,e=2;t<e;t++){do{this.draggingSprite=r(t),this.didCollide()}while(this.isCollide);i[t]=this.draggingSprite,this.draggingSprite=null}}createCircle(){let{width:t,height:e,circles:i}=this,l=["rgba(244, 235, 65, 0.5)","rgba(66, 244, 86,0.5)"],r=Math.min(Math.min(t,e)/10,50),n=i=>{let n=Math.floor(Object(s.d)(r,t)),h=Math.floor(Object(s.d)(r,e));return n+r>t&&(n-=r),h+r>e&&(h-=r),new o.CircleSprite({name:`circle_${i}`,x:n,y:h,radius:r,fillStyle:l[i%2],visible:!0})};for(let t=0,e=2;t<e;t++){do{this.draggingSprite=n(t),this.didCollide()}while(this.isCollide);i[t]=this.draggingSprite,this.draggingSprite=null}}drawTitle(){let{ctx:t,width:e,height:i,isCollide:l,collideColor:s}=this;t.save(),t.font=r.a,t.textAlign="center",t.fillStyle=l?s:"rgba(66, 134, 244, 0.8)";let n=t.measureText("M").width;t.fillText(l?"碰撞了":"碰撞检测：外接图形法",e/2,n+n/6+10),t.restore()}drawRect(){let{ctx:t,rects:e,draggingSprite:i}=this;t.save();for(let[l,{left:s,top:r,width:n,height:o,fillStyle:h,visible:d}]of e.entries())d&&e[l]!==i&&(t.fillStyle=h,t.beginPath(),t.rect(s,r,n,o),t.fill());t.restore()}drawCircle(){let{circles:t,ctx:e,draggingSprite:i}=this;e.save();for(let[l,{fillStyle:s,visible:r,x:n,y:o,radius:h}]of t.entries())r&&t[l]!==i&&(e.fillStyle=s,e.beginPath(),e.arc(n,o,h,0,2*Math.PI,!1),e.fill())}drawDraggingSprite(){let{ctx:t,draggingSprite:e}=this;if(this.draggingSprite){if(t.save(),t.fillStyle=e.fillStyle,t.beginPath(),"rect"===e.type){let{left:i,top:l,width:s,height:r}=e;t.rect(i,l,s,r)}else{let{x:i,y:l,radius:s}=e;t.arc(i,l,s,0,2*Math.PI,!1)}t.fill(),t.restore()}}drawCollideTip(){let{ctx:t,isCollide:e,collideColor:i,width:l,height:s}=this;e&&(t.save(),t.strokeStyle=i,t.lineWidth=10,t.strokeRect(0,0,l,s),t.restore())}bindEvent(){let{width:t,height:e,el:i}=this,l=t=>e=>t.call(this,(t=>{let e,i;return t.preventDefault(),n.a.pc?(e=t.x,i=t.y):(e=t.touches[0].pageX,i=t.touches[0].pageY),{ex:e,ey:i}})(e));n.a.pc?(i.addEventListener("mousedown",l(this.mouseDown),!1),i.addEventListener("mousemove",l(this.mouseMove),!1),i.addEventListener("mouseup",this.mouseUp.bind(this),!1),i.addEventListener("mouseleave",this.mouseUp.bind(this),!1)):(i.addEventListener("touchstart",l(this.mouseDown),!1),i.addEventListener("touchmove",l(this.mouseMove),!1),i.addEventListener("touchend",this.mouseUp.bind(this),!1),i.addEventListener("touchcancel",this.mouseUp.bind(this),!1))}mouseDown({ex:t,ey:e}){let{el:i,ctx:l,rects:r,circles:n}=this,{x:o,y:h}=Object(s.h)(i,t,e);for(let[t,{left:e,top:i,width:s,height:n,visible:d}]of r.entries())if(d&&(l.beginPath(),l.rect(e,i,s,n),l.isPointInPath(o,h))){this.draggingSprite=r[t],this.lastMovePoint={left:o,top:h};break}if(!this.draggingSprite)for(let t of n)if(t.visible&&(l.beginPath(),l.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),l.isPointInPath(o,h))){this.draggingSprite=t,this.lastMovePoint={left:o,top:h};break}}mouseMove({ex:t,ey:e}){let{el:i,ctx:l,collide:r,rects:n,draggingSprite:o,width:h,height:d,lastMovePoint:a}=this,{x:c,y:u}=Object(s.h)(i,t,e);o&&("rect"===o.type?this.moveRect(o,c,u):"circle"===o.type&&this.moveCircle(o,c,u),this.lastMovePoint={left:c,top:u},this.didCollide(),this.draw())}mouseUp(){this.draggingSprite=null,this.lastMovePoint=null}moveRect(t,e,i){let{width:l,height:s,lastMovePoint:r}=this;t.left+=e-r.left,t.top+=i-r.top,t.left=Math.max(0,t.left),t.left=Math.min(l-t.width,t.left),t.top=Math.max(0,t.top),t.top=Math.min(s-t.height,t.top)}moveCircle(t,e,i){let{width:l,height:s,lastMovePoint:r}=this;t.x+=e-r.left,t.y+=i-r.top,t.x=Math.max(t.radius,t.x),t.x=Math.min(l-t.radius,t.x),t.y=Math.max(t.radius,t.y),t.y=Math.min(s-t.radius,t.y)}didCollide(){let{rects:t,circles:e,draggingSprite:i,collide:l}=this;if(this.isCollide=!1,i){for(let e of t)l.isCandidateForCollide(i,e)&&l.didCollide(i,e)&&(this.isCollide=!0,console.log(`occur collide: ${i.name} and ${e.name}`));for(let t of e)l.isCandidateForCollide(i,t)&&l.didCollide(i,t)&&(this.isCollide=!0,console.log(`occur collide: ${i.name} and ${t.name}`))}}draw(){let{ctx:t,width:e,height:i}=this;t.clearRect(0,0,e,i),this.drawTitle(),this.drawRect(),this.drawCircle(),this.drawDraggingSprite(),this.drawCollideTip()}render(t){super.render(t),this.createRect(),this.createCircle(),this.draw(),this.bindEvent()}}},"0Pcb":function(t,e,i){"use strict";const l=function(){const t=window.navigator.userAgent;return window.location.href,function(t){const e={},i=t.indexOf("iPhone")>=0||t.indexOf("iPad")>=0||t.indexOf("iPod")>=0,l=t.indexOf("Android")>0;return e.ios=i,e.android=l,e.mobile=i||l,e.pc=!i&&!l,e}(t)}();e.a=l},JaKB:function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return l}),i.d(e,"RectSprite",function(){return s}),i.d(e,"CircleSprite",function(){return r});class l{constructor({type:t,fillStyle:e,name:i="anonymous",visible:l=!1}={}){this.type=t,this.name=i,this.visible=l,this.fillStyle=e}}class s extends l{constructor(t){super(t),this.type="rect",this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height}}class r extends l{constructor(t){super(t),this.type="circle",this.x=t.x,this.y=t.y,this.radius=t.radius}}},Qb4n:function(t,e,i){"use strict";var l=i("kZAv");e.a=class{constructor(){this.el=document.createElement("canvas")}initCanvasSize(t,e){this.el.width=t,this.el.height=e,this.width=t,this.height=e}getContext(t,e){return this.el.getContext(t,e)}render(t){this.container=t;let{width:e,height:i}=t.getBoundingClientRect();this.initCanvasSize(e||l.d,i||l.b),this.container.innerHTML="",this.container.appendChild(this.el)}}},kZAv:function(t,e,i){"use strict";i.d(e,"d",function(){return l}),i.d(e,"b",function(){return s}),i.d(e,"a",function(){return r}),i.d(e,"c",function(){return n});const l=500,s=500,r=`${i("0Pcb").a.pc?24:16}px sans-serif`,n="https://snayan.github.io/canvas-demo/"},"lLY/":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});var l=i("ysz4");class s{constructor(){return this instanceof s?this:new s}isCandidateForCollide(t,e){return t.visible&&e.visible&&t!==e}didCollide(t,e){let i=t.type,l=e.type;return"rect"===i&&"rect"===l?this.didRectCollide(t,e):"circle"===i&&"circle"===l?this.didCircleCollide(t,e):"rect"===i?this.didRectWidthCircleCollide(t,e):this.didRectWidthCircleCollide(e,t)}didRectCollide(t,e){let i=t.left+t.width>e.left&&t.left<e.left+e.width,l=t.top<e.top+e.height&&t.top+t.height>e.top;return i&&l}didCircleCollide(t,e){return Object(l.a)(t.x,t.y,e.x,e.y)<t.radius+e.radius}didRectWidthCircleCollide(t,e){let i={x:void 0,y:void 0};return e.x<t.left?i.x=t.left:e.x<t.left+t.width?i.x=e.x:i.x=t.left+t.width,e.y<t.top?i.y=t.top:e.y<t.top+t.height?i.y=e.y:i.y=t.top+t.height,Object(l.a)(e.x,e.y,i.x,i.y)<e.radius}}}}]);